on:
  push:
    branches: [master]
    paths-ignore:
      - 'docs/**'
      - 'LICENCE'
      - 'CONTRIBUTION.md'
      - 'README.md'
  pull_request:
    branches: [master]
    paths-ignore:
      - 'docs/**'
      - 'LICENCE'
      - 'CONTRIBUTION.md'
      - 'README.md'

# permissions:
#   # deployments permission to deploy GitHub pages website
#   deployments: write
#   # contents permission to update benchmark contents in gh-pages branch
#   contents: write

jobs:
  benchmark:
    name: Performance regression check
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build Slang
        run: |
            cmake --preset default --fresh \
              -DSLANG_SLANG_LLVM_FLAVOR=USE_SYSTEM_LLVM \
              -DCMAKE_COMPILE_WARNING_AS_ERROR=false
            cmake --workflow --preset release
          fi
      - name: Run benchmark
        run: |
            python.exe tests/mdl/compile.py --samples 1
